---
title: "ml_a1_md_draft"
author: "Josh Grosman and Tim Kirkbride"
date: "March 23, 2018"
output: html_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(readr)
library(dplyr)
library(mlr)
library(lubridate)
```

## Introduction

This project aimed to construct a classification model to predict whether a Kickstarter project will be successful or otherwise. This project is split into two phases: Phase 1, which will focus on data preprocessing and exploration, and Phase 2, which will be concered with model building and validation. Only Phase 1 of the project will be presented in this report. In this phase, the dataset and its attrbiutes will be unpacked and described. The data will then be cleaned and preprocessed and finally, all relevant attrbiutes will be explored with regards to their relationships with each other.

## Dataset

```{r}
ks <- read_csv("ks-projects-201801.csv")
```

The dataset used was obtained from Kaggle and can be found here:

https://www.kaggle.com/kemical/kickstarter-projects/data

This project used the 2018 dataset, which contained the more recently updated data. The dataset contained 378,661 observations, each corresponding to a different Kickstarter project launched between 2009-2018. The dataset consisted of 14 feature variables and one target variable. 


### Target Feautre

The target feature used in this analysis was the state of the project at the time of its deadline. The levels of the target variable are denoted as follows:

* Cancelled: If the project was cancelled premature to its deadline

* Failed: If the project was unable to generate its goal amount by the time of its deadline

* Live: If the project has not yet reached its deadline and is still active

* Succesful: If the project was able to at least generate its goal amount by the time of its deadline

* Suspended: If the project is found to be in breech of the Kickstarter rules, all funding for the project stops indefintely and all previous pledges are cancelled

* Undefined: If it is unknown which of the above categories is most appropriate

While the target feature was originally comprised of six classes, the present analysis was only concerned with predicting whether a Kickstarter project will be successful or fail. Furthermore, all of the observations which related to the four remaining target levels combined only comprised a minority of the overall observations (10.91%). As such, it was decided that observations classifed under the levels of live, canceled, suspended or undefined would not be considered in the analysis, and only observations relating to successful or failed projects would be retained.

```{r}
ks_filt<-ks%>%filter(state %in% c("successful","failed"))
```

As as result of this, the dataset now contained 331,675 observations relating to successful and failed Kickstarter projects. The target feature would only have two classes and therefore the analysis would be binary classifcation.

### Descriptive Features

* ID: continuous
* name: string
* category: factor (159 levels)
* main_category: factor (Art, Comics, Crafts, Dance, Design, Fashion, Film & Video, Food, Games, Journalism, Music, Photography, Publishing, Technology, Theater)
* currency: factor (AUD, CAD, CHF, DKK, EUR, GBP, HKD, JPY, MXN, NOK, NZD, SEK, SGD, USD)
* deadline: date
* goal: continuous
* launched: date
* pledged: continuous
* backers: integer
* country: (AT, AU, BE, CA, CH, DE, DK, ES, FR, GB, HK, IE, IT, JP, LU, MX, N,0\", NL, NO, NZ, SE, SG, US)
* us_pledged: continuous
* us_pledged_real: continuous
* us_goal_real: continuous

Many of the descriptive features here are self-explanatory. The last three features are corrections of the pledged and goal features, which convert the relevant currency amounts of the associated observations to USD. Information from the website where the dataset was retrived suggests that usd_pledged was created to standardise the pledged column to USD, but there were issues with the conversion which resulted in errors. The usd_pledged_real feature amended these errors and has the correct amount pledged in USD. The feature usd_goal_real has the USD amount of the project's goal.

Inspection of the levels of the country feature highlight a potential typo, where a country was assigned the code 'N,0\"', which clearly does not correspond with the rest of the levels. This will be examined further in the next section of this report.

## Data Preprocessing

### Initial Inspection and Error Identification

Prior to summarization, some obviously redundant columns were removed. The features ID and name would clearly add no value in predicting the target variable and were dropped. Additionally, as the columns usd_goal_real and usd_pledged_real contained the correct standardised goal and pledged amounts respectively, the pledged, goal and usd_pledged features were no longer relevant and were dropped.

```{r}
ks_filt$ID<-NULL
ks_filt$name<-NULL
ks_filt$`usd pledged`<-NULL
ks_filt$pledged<-NULL
ks_filt$goal<-NULL
```

The dataset was summarised in Table 1 and 2 below.

```{r}
head(ks_filt)%>% knitr::kable( caption = 'Table 1. First 6 rows of Kickstarter Data')
```


```{r}
summarizeColumns(ks_filt)%>% knitr::kable( caption = 'Table 2. Feature Summary before Data Preprocessing')

```

From Table 1 and Table 2, it is clear that data has been read in correctly and there no missing values or any obvious errors/typos. However, some issues were noted.

* As mentioned previously, there was a suspected typo in the name of one the levels of the country feature - N,0\".

* Looking at the classes of each feature shown in Table 1, the two date columns - launched and deadline - are not of the same class, which may become an issue if these columns are needed to created a new variable. Furthermore, as the time dimension is applicable as a feature within the present analysis, these two columns will ultimately need to be dropped.

* The catergory and main_category columns appear to represent the same underlying feature - the type of buisness of the Kickstarter project, however, as seen in Table 2, the cardinality of category was very large at 159 levels compared to that of main_category, which had only 15 levels.

* The currency and country columns seem to hold fairly similar information. As such, dropping one may be necessary. This would need to be investigated visually, however, so will be dealt with in the next section.

* It is clear that all factor columns were defined as the character class when imported and will need be converted.

### Data Wrangling and Correction

Firstly, the extent of the N,0\" typo within the country feature was explored further. Perusal of the website where data were retreived provided no explaination to the meaning of this value. Therefore, this level was considered to classify as a missing value, and was converted as such. The proportion of complete cases (i.e. those which had no missing values) was then calculated.

```{r}
ks_filt$country <- ifelse(ks_filt$country == "N,0\"", NA, ks_filt$country)
sum(complete.cases(ks_filt))/nrow(ks_filt)
```

Here, we see that the proprotion of complete cases is very high, at 99.94% of all observations. This suggested that the number of observations affected by the typo was minimal and as such, it was deemed appropriate to omit all affected observations from the analysis.

```{r}
ks_filt<-ks_filt%>%na.omit()
```

Next, to was decided that a new feature would be created to represent the duration in days that each project lasted by finding the difference between the two date columns. First, the launched column would have to be converted to the correct date format. In its current state, launched included not only the date, but also the time at which the project was launched. As such, it was converted.

```{r}
ks_filt$launched <- format(as.POSIXct(ks_filt$launched,format='%Y/%m/%d %H:%M:%S'),format='%Y/%m/%d')
ks_filt$launched<-ks_filt$launched%>%as.Date()
```

The duration feature was then added to the dataset by subtracting the launched column from the deadline column. Subseqently, the launched and deadline columns were dropped as they were no longer needed.

```{r}
ks_filt$duration<-as.numeric(ks_filt$deadline-ks_filt$launched)
ks_filt$launched<-NULL
ks_filt$deadline<-NULL
```

Next, the main category and category features were considered. Inspection of these features highlighted that main_category was simply be a reduced version of catgeory with far fewer levels. This left category essentially redundant, so it was removed.

```{r}
ks_filt$category<-NULL
```

Finally, all features loaded in as the character type were converted to factors.

```{r}
ks_filt[sapply(ks_filt, is.character)] <- lapply(ks_filt[sapply(ks_filt, is.character)], as.factor)
```

As a result of all the above amendments, the dataset now contained 331,465 observations, 1 target feature with two levels and 6 feature variables.

# Data Exploration

## Univariate Visualisations

Initially, the overall counts of succesful and failed projects was examined.

```{r}
p1<-ggplot(ks_filt,aes(x=state))

p1+geom_bar()+
  labs(title="Figure 1. Bar Chart of Project State",
       y="Count",
       x="State")
```

Clearly the main point here is that there were more failed projects in the data than there were sucessful ones. This should be considered in visualisations to come.

The main_category feature was then visualised to explore the differences across its levels with regards to the state of the project.

```{r}
p2 <- ggplot(ks_filt, aes(x = main_category))

p2 + geom_bar()+
  labs(title = "Figure 2. Bar Chart of Project Category",
       x = "Category",
       y = "Count")+
  theme(axis.text.x=element_text(angle=45, hjust=1))
```


```{r}
cat_state <- table(ks_filt$main_category,ks_filt$state, dnn = c("Category","State"))
prop.cat_state<-data.frame(prop.table(cat_state,1))
colnames(prop.cat_state) <- c("Category","State","Proportion")

p3<-ggplot(prop.cat_state,aes(x=Category,y=Proportion,fill=State))
p3+geom_bar(stat="identity",position="dodge")+
  labs(title="Figure 3. Proportions of Project State within Catgeories",
       y="Proportion within Category")+
  theme(axis.text.x=element_text(angle=45, hjust=1))
```

Here we see the distribution of the types of projects included in the dataset, as well as the proportions of successful and failed projects within each category. Showing proportions instead of counts allows for direct comparison accross the levels of the main_category feature. This highlights that generally, most categories are associted with failed projects, except for comics, dance, music and theater. Clearly these are all related to the arts.

Next we looked at the currency and country feature simultaniously to determine if either was any redundancy.

```{r}
ggplot(ks_filt, aes(x = country)) + geom_bar() +
  labs(title="Figure 4. Bar Chart of Country",
       y="Count",
       x="Country")
```

```{r}
ggplot(ks_filt, aes(x = currency)) + geom_bar()+
  labs(title="Figure 5. Bar Chart of Currency",
       y="Count",
       x="Country")
```

Inspection of Figures 4 and 5 does highlight a striking similarity. Additionally, they also serve to emphasise that a large proportion of the projects are associated with the US, and also, that many other countries and currencies have much smaller amounts of associated projects. As such, utilising either of these features may lead to some issues. It was therefore decided that it would be best to aggregate the levels of the country feature to represent the continents, and to then drop the country and currency features. The plots of the new continent feature are shown below.

```{r}
europe <- c("AT", "BE", "DE", "DK", "ES", "FR", "GB", "IE", "IT", "LU", "NL", "NO", "SE")
north_america <- c("CA", "MX", "US")
asia <- c("CH", "HK", "JP", "SG")
oceania <- c("AU", "NZ")

ks_filt$continent <- case_when(
  ks_filt$country %in% europe ~ "Europe",
  ks_filt$country %in% north_america ~ "North America",
  ks_filt$country %in% asia ~ "Asia",
  ks_filt$country %in% oceania ~ "Oceania"
)

ks_filt$country<-NULL
ks_filt$currency<-NULL
```
```{r}
p4 <- ggplot(ks_filt, aes(x = continent))

p4 + geom_bar(position = "dodge")+
  labs(title="Figure 6. Bar Chart of Continent",
       y="Count",
       x="Continent")
```

Obviously, this Figure 5 still shows that North America dominates the projects being assessed, however the other levels are now more concentrated. Despite this, the amount of projects originating from Asia and Oceania remains very small.

```{r}
cont_state <- table(ks_filt$continent,ks_filt$state, dnn = c("Continent","State"))
prop.cont_state<-data.frame(prop.table(cont_state,1))
colnames(prop.cont_state) <- c("Continent","State","Proportion")

p5<-ggplot(prop.cont_state,aes(x=Continent,y=Proportion,fill=State))
p5+geom_bar(stat="identity",position="dodge")+
  labs(title="Figure 6. Proportions of Project State within Continent")
```

From the Figure 6 above, we see that the proportions of failed and succesfull projects from Asia and Europe are almost identical. North America appears to have a slightly higher proportion of successful projects in comparision, while Oceania has a lower proportion of successful projects.

The duration feature was explored next. As seen from Figures 7 and 8 below, there is little distinction between the duration of successful and failed projects duration. This will need to further investigated in the next phase of this analysis in order to determine whether duration is suitable feature to include.
```{r}
p6 <- ggplot(ks_filt, aes(x = duration))
p6+geom_histogram()+
  labs(title="Figure 7. Histogram of Project Duration",
       x="Duration",
       y="Count")
```


```{r}
p7 <- ggplot(ks_filt, aes(x = duration))

p7 + geom_histogram(aes(fill = state)) + 
labs(title = "Figure 8. Histogram of Project Duration by State",
x = "Duration",
y = "Count",
fill = "State") +
facet_grid(~state)
```

Figure 9 below depicts the number of backers each projects had and shows a clear positive skew. Figure 10 further shows that the distribution is essentially split across the state feature, with failed projects more associted with zero backers, and successful ones having much more varience. 
It should be noted that to best visualise backers, higher values were filtered out. 

```{r}
back_filt<-ks_filt%>%filter(backers<150)

p8<-ggplot(back_filt,aes(x=backers))
p8+geom_histogram()+ 
labs(title = "Figure 9. Histogram of Project Backers",
x = "Backers",
y = "Count")
```


```{r}
p9 <- ggplot(back_filt, aes(x = backers,fill=state))

p9 + geom_density(alpha=.4) + 
labs(title = "Figure 10. Density of Project Backers by State",
x = "Backers",
y = "Density",
fill = "State")
```


Each project's goal was visualised in Figures 11 and 12. Figure 11 highlights an unsual distribution with spikes at every $5000. This may be attributable to indivduals commonly setting goals at these essentially arbitrary points.
Figure 12 highlights an interesting insight which suggests that projects with lower goals are more likely to be successful than projects with higher goals, with the threshold level at approximately $4000. This makes intuitive sense as smaller goals would be more easily achieved, which would then classify the project as successful.
Again, observations with very large goals were fitlered out to best visualise the feature.

```{r}
ks_goal <- ks_filt %>% filter(usd_goal_real <= 25000)

p10 <- ggplot(ks_goal, aes(x = usd_goal_real))

p10 + geom_histogram() + 
labs(title = "Figure 11. Histogram of Project Goal by State",
x = "Goal",
y = "Count")
```


```{r}
p10+ geom_density(aes(fill = state), alpha = 0.4)+ 
labs(title = "Figure 12. Density of Project Goal by State",
x = "Goal (USD)",
y = "Density",
fill = "State")
```

The amount pledged to each project is visualised below in Figures 13 and 14. Here, there is a striking similarity to the visualisations of the backers feature shown in Figures 9 and 10. Again, the overall distribution is highly positively skewed, with the majority of failed projects recieving very little fudning, while the amount pledged to successful projects has considerable variablity.
The data used in this visualisation was once again filtered of extreme values.

```{r}
pledge_filt<-ks_filt%>%filter(usd_pledged_real<4000)

p11 <- ggplot(pledge_filt, aes(x = usd_pledged_real))

p11 + geom_histogram()+ 
labs(title = "Figure 13. Histogram of Amount Pledged to Project",
x = "Amount Pledged (USD)",
y = "Count")

```

```{r}
p12 <- ggplot(pledge_filt, aes(x = usd_pledged_real,fill=state))

p12 + geom_density(alpha=.4) + 
labs(title = "Figure 14. Density of Amount Pledged to Project by State",
x = "Amount Pledged (USD)",
y = "Density",
fill = "State")
```

## Multivariate Visualisations

Figure 15 below highlights the relationship between a project's goal and its category. Inspection of the different facets emphasises that while setting smaller goals is generally likely to result in a succesful project, this is not true for all categories. Categories such as food, design and technology do not strickly adhere to this rule and demonstrate relatively high amounts of successful projects at higher goals. Other categories such as dance, comics and theatre are also different in that they seem to have high proportions of successful projects regardless of the goal.

```{r}
p13<-ggplot(ks_goal,aes(x=usd_goal_real, fill=state))

p13 + geom_histogram() + facet_wrap(~main_category)+
  labs(title = "Figure 15. Project Goal by State across Category",
       x="Goal (USD)",
       y="Count")
```


```{r}
pledge_filt2<-ks_filt%>%filter(usd_pledged_real<7500)
p14<-ggplot(pledge_filt2,aes(x=continent,y=usd_pledged_real,fill=state))
p14+geom_boxplot()+
  labs(title = "Figure 16. Boxplot of Amount Pledged by Project State and Continent",
       x="Continent",
       y="Amount Pledged (USD)")
```

The amount pledged to a project acroding to its continent of origin is depicted in Figure 16 above. Here we see minimal differences in the distribution of the amounts pledged to failed projects across continents, all showing on average next to zero funding. It is also clear that there are many outliers in the failed state, which despite receiving considerable funding still failed. However, it is interesting to see that Asia has the highest mean amount pledged to successful projects of all other continents, when it was previously shown that it had by far the smallest representation in the dataset. This suggests that in general, projects started in Asia would receieve more funding.

```{r}
ks_scatter<-ks_filt%>%filter(backers < 10000)
ks_scatter<-ks_scatter%>%filter(usd_pledged_real < 1000000)

set.seed(90)
index <- sample(1:nrow(ks_scatter), 5000)
ks_rand<-ks_scatter[index, ]

p15 <- ggplot(ks_rand, aes(x = backers, y = usd_pledged_real))

p15 + geom_point(aes(colour = state,size=usd_goal_real),alpha=.3)+
  facet_wrap(~state)+
  labs(title="Figure 17. Project State by Amount Pledged to Project, Backers and Goal",
       y="Amount Pledged (USD)",
       x="Backers")

```

There are several interesting points to note about Figure 17. Firstly, it clear in both facets that a large concentration of projects received litting funding and had few backers. This is espeically true of failed projects, which are mostly concetrated around the origin. Visually, this gives off the sense that the failed facet has fewer points, when in fact failed projects were more common than succesful ones. The succesful projects are much more spread out and suggest a moderate postiive relationship between backers and amount pledged. The dispertion of successful points is also promising for the upcoming analysis, as it suggests that there is not too much correspondence between backers and amount pledged. The goals of failed projects also appear to be considerably larger than those of the successful ones, especially at the origin of the failed facet. As previously mentioned, this would suggest that perhaps these projects were too ambitious with their goals, and considering this, it would make sense that the projects with smaller goals were more likely to reach thir targets and become successful.
This plot was constructed using a random sample from the dataset.